From 335550171a73e158ae248a8501b07eadc8109bb7 Mon Sep 17 00:00:00 2001
From: Hannes Mann <hannesmann2000@gmail.com>
Date: Wed, 13 Dec 2023 05:10:47 +0100
Subject: [PATCH 2/4] Do not schedule repaint when moving mouse without AMS

---
 src/backends/drm/drm_pipeline.cpp | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/src/backends/drm/drm_pipeline.cpp b/src/backends/drm/drm_pipeline.cpp
index 84ee4d1655..b0f5a046ad 100644
--- a/src/backends/drm/drm_pipeline.cpp
+++ b/src/backends/drm/drm_pipeline.cpp
@@ -451,7 +451,7 @@ bool DrmPipeline::setCursor(const QPoint &hotspot)
     // explicitly check for the cursor plane and not for AMS, as we might not always have one
     if (m_pending.crtc->cursorPlane()) {
         result = commitPipelines({this}, CommitMode::Test) == Error::None;
-        if (result && m_output) {
+        if (result && m_output && gpu()->atomicModeSetting()) {
             m_output->renderLoop()->scheduleRepaint();
         }
     } else {
@@ -476,7 +476,7 @@ bool DrmPipeline::moveCursor()
     }
     if (result) {
         m_next = m_pending;
-        if (m_output) {
+        if (m_output && gpu()->atomicModeSetting()) {
             m_output->renderLoop()->scheduleRepaint();
         }
     } else {
-- 
2.43.0

